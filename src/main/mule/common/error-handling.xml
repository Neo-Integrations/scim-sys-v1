<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:json-logger="http://www.mulesoft.org/schema/mule/json-logger"
	xmlns:ee="http://www.mulesoft.org/schema/mule/ee/core" xmlns:dw="http://www.mulesoft.org/schema/mule/ee/dw"
	xmlns="http://www.mulesoft.org/schema/mule/core"
	xmlns:doc="http://www.mulesoft.org/schema/mule/documentation" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="
http://www.mulesoft.org/schema/mule/ee/dw http://www.mulesoft.org/schema/mule/ee/dw/current/dw.xsd http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
http://www.mulesoft.org/schema/mule/ee/core http://www.mulesoft.org/schema/mule/ee/core/current/mule-ee.xsd
http://www.mulesoft.org/schema/mule/json-logger http://www.mulesoft.org/schema/mule/json-logger/current/mule-json-logger.xsd">

		<error-handler
		name="globalErrorHandler"
		doc:id="93357391-6244-487a-bda3-70f1016db551">
		<!-- APIKit router related exceptions -->
		<on-error-propagate
			
			type="APIKIT:BAD_REQUEST"
			enableNotifications="false"
			logException="true"
			doc:name="On Error Propagate"
			doc:id="c13b15cd-5c3c-4111-ba5c-d9afa2d7ac5b"
		>
			<set-variable
				value="#[400]"
				doc:name="Set the HTTP Status - 400"
				doc:id="e4095186-2b1f-4669-b867-37dee278dca2"
				variableName="httpStatus" />
				<ee:transform
				doc:name="Set ErrorMessage"
				doc:id="4608bb94-81b7-47b2-b022-ea0291c648f2"
			>
				<ee:message>
				</ee:message>
				<ee:variables>
					<ee:set-variable variableName="errorMessage"><![CDATA[%dw 2.0
output application/java
---
{

	"title": "The backend responded with an error",
	"detail": "The server cannot or will not process the request due to an apparent client error (e.g., malformed request syntax, size too large, invalid request message framing, or deceptive request routing)."

}]]></ee:set-variable>
				</ee:variables>
			</ee:transform>
			<flow-ref
				doc:name="global-prepare-error-response-sub-flow"
				doc:id="69be2b91-7e41-487b-b68d-9cf61742938e"
				name="global-prepare-error-response-subflow" />
		</on-error-propagate>
		<on-error-propagate
			type="APIKIT:METHOD_NOT_ALLOWED"
			enableNotifications="true"
			logException="true"
			doc:name="On Error Propagate"
			doc:id="09b90c4b-85a7-4121-b4c0-7a7d4e07c49b"
		>
			<set-variable
				value="#[405]"
				doc:name="Set the HTTP Status - 405"
				doc:id="1027111e-3e83-4010-9d23-c147c56b166b"
				variableName="httpStatus" />
				<ee:transform
				doc:name="Set ErrorMessage"
				doc:id="d5e5da69-2f93-42ae-a53a-612fa95d554d"
			>
				<ee:message>
				</ee:message>
				<ee:variables>
					<ee:set-variable variableName="errorMessage"><![CDATA[%dw 2.0
output application/java
---
{

	"title": "The backend responded with an error",
	"detail": "A request method is not supported for the requested resource."
}]]></ee:set-variable>
				</ee:variables>
			</ee:transform>
			<flow-ref
				doc:name="global-prepare-error-response-sub-flow"
				doc:id="20874b51-c235-41ac-9741-36a51196336b"
				name="global-prepare-error-response-subflow" />
		</on-error-propagate>
		<on-error-propagate
			type="APIKIT:NOT_ACCEPTABLE"
			enableNotifications="true"
			logException="true"
			doc:name="On Error Propagate"
			doc:id="52fa7f4a-5e78-4e9c-8010-2a37a81fb902"
		>
			<set-variable
				value="#[406]"
				doc:name="Set the HTTP Status - 406"
				doc:id="74bfa042-7355-4b87-abf2-948bea703aa1"
				variableName="httpStatus" />
				<ee:transform
				doc:name="Set ErrorMessage"
				doc:id="5edb4e94-e503-46f7-95f2-df9925c611dc"
			>
				<ee:message>
				</ee:message>
				<ee:variables>
					<ee:set-variable variableName="errorMessage"><![CDATA[%dw 2.0
output application/java
---
{

	"title": "The backend responded with an error",
	"detail": "The requested resource is capable of generating only content not acceptable according to the Accept headers sent in the request."
}]]></ee:set-variable>
				</ee:variables>
			</ee:transform>
			<flow-ref
				doc:name="global-prepare-error-response-sub-flow"
				doc:id="16757f94-5343-4340-8a2a-1431efc839e3"
				name="global-prepare-error-response-subflow" />
		</on-error-propagate>
		<on-error-propagate
			type="APIKIT:NOT_FOUND"
			enableNotifications="true"
			logException="true"
			doc:name="On Error Propagate"
			doc:id="b9f7fdb0-df5e-44f9-b760-9a1669a111d1"
		>
			<set-variable
				value="#[404]"
				doc:name="Set the HTTP Status - 404"
				doc:id="3fd6153e-ddd0-4014-94f0-f9e877ffa13f"
				variableName="httpStatus" />
			<ee:transform
				doc:name="Set ErrorMessage"
				doc:id="f9123a25-54c1-4821-b32e-0e23fa7d9aea"
			>
				<ee:message>
				</ee:message>
				<ee:variables>
					<ee:set-variable variableName="errorMessage"><![CDATA[%dw 2.0
output application/java
---
{
	"title": "The backend responded with an error",
	"detail": "The requested resource could not be found but may be available in the future."
}]]></ee:set-variable>
				</ee:variables>
			</ee:transform>
			<flow-ref
				doc:name="global-prepare-error-response-sub-flow"
				doc:id="55861faa-139b-46be-84c5-59875c1dd1c4"
				name="global-prepare-error-response-subflow" />
		</on-error-propagate>
		<on-error-propagate
			type="APIKIT:UNSUPPORTED_MEDIA_TYPE"
			enableNotifications="true"
			logException="true"
			doc:name="On Error Propagate"
			doc:id="f44756a0-3030-4edc-ab02-15732eacaf3e"
		>
			<set-variable
				value="#[415]"
				doc:name="Set the HTTP Status - 415"
				doc:id="cd2f625e-f27b-457b-b31d-ef5e68815d30"
				variableName="httpStatus" />
			<ee:transform
				doc:name="Set ErrorMessage"
				doc:id="2bb6df4b-1e9d-4154-a88d-9a24743ed608"
			>
				<ee:message>
				</ee:message>
				<ee:variables>
					<ee:set-variable variableName="errorMessage"><![CDATA[%dw 2.0
output application/java
---
{

		"title": "The backend responded with an error",
		"detail": "The request entity has a media type which the server or resource does not support. For example, the client uploads an image as image/svg+xml, but the server requires that images use a different format."
	
}]]></ee:set-variable>
				</ee:variables>
			</ee:transform>
			<flow-ref
				doc:name="global-prepare-error-response-sub-flow"
				doc:id="b7346436-e02e-45f6-85fb-116b14d7f937"
				name="global-prepare-error-response-subflow" />
		</on-error-propagate>
		<!-- DB Related issues -->
		<on-error-propagate
      when="#[error.errorType.namespace == 'DB' or error.errorType.identifier == 'BAD_SQL_SYNTAX']"
			enableNotifications="true"
			logException="true"
			doc:name="On Error Propagate"
			doc:id="f8d2764a-ef9b-4ad0-8326-75fe80fdc6a3"
		>
			<set-variable
				value="#[500]"
				doc:name="Set the HTTP Status - 500"
				doc:id="7670cc2f-d5e2-4c1e-96b1-9a3fc148a8a6"
				variableName="httpStatus" />
			<ee:transform
				doc:name="Set ErrorMessage"
				doc:id="44dd9c62-d95b-492f-8cc9-69dafc42e3d7"
			>
				<ee:variables>
					<ee:set-variable variableName="errorMessage"><![CDATA[%dw 2.0
output application/java
---
{

		"title": "The backend responded with an error",
		"detail": "Bad SQL Syntax."
}]]></ee:set-variable>
				</ee:variables>
			</ee:transform>
			<flow-ref
				doc:name="global-prepare-error-response-sub-flow"
				doc:id="167337bc-45e8-4eb7-abc4-1852bd3cb956"
				name="global-prepare-error-response-subflow" />
		</on-error-propagate>
		<on-error-propagate
			
      when="#[error.errorType.namespace == 'DB' or error.errorType.identifier == 'CONNECTIVITY']"
			enableNotifications="true"
			logException="true"
			doc:name="On Error Propagate"
			doc:id="b8114aa8-0399-490f-a595-70fa9909f226"
		>
			<set-variable
				value="#[503]"
				doc:name="Set the HTTP Status - 503"
				doc:id="98d7dee6-aa36-4cf7-9192-fb46ffb8f733"
				variableName="httpStatus" />
			<ee:transform
				doc:name="Set ErrorMessage"
				doc:id="56af1446-597b-4b30-b59b-55a98b00b29d"
			>
				<ee:variables>
					<ee:set-variable variableName="errorMessage"><![CDATA[%dw 2.0
output application/java
---
{

		"title": "The backend responded with an error",
		"detail": "The database server cannot handle the request (because it is overloaded or down for maintenance). Generally, this is a temporary state."

}]]></ee:set-variable>
				</ee:variables>
			</ee:transform>
			<flow-ref
				doc:name="global-prepare-error-response-sub-flow"
				doc:id="ba798d4b-9789-4322-bae1-47c44ca56712"
				name="global-prepare-error-response-subflow" />
		</on-error-propagate>
		<on-error-propagate

      when="#[error.errorType.namespace == 'DB' or error.errorType.identifier == 'QUERY_EXECUTION']"
			enableNotifications="true"
			logException="true"
			doc:name="On Error Propagate"
			doc:id="840dab96-dd5f-4fc5-a246-dc1eaa2cbbe8"
		>
			<set-variable
				value="#[500]"
				doc:name="Set the HTTP Status - 500"
				doc:id="c629786e-816a-4dab-bd1a-7d344455170f"
				variableName="httpStatus" />
			<ee:transform
				doc:name="Set ErrorMessage"
				doc:id="bfd24c56-d127-48a0-b70f-e4e931e1089e"
			>
				<ee:variables>
					<ee:set-variable variableName="errorMessage"><![CDATA[%dw 2.0
output application/java
---
{

		"title": "The backend responded with an error",
		"detail": "The database query execution failed."

}]]></ee:set-variable>
				</ee:variables>
			</ee:transform>
			<flow-ref
				doc:name="global-prepare-error-response-sub-flow"
				doc:id="ec9e66f4-1d5c-40ae-9f1e-2c6920d0b14a"
				name="global-prepare-error-response-subflow" />
		</on-error-propagate>
		<on-error-propagate
      when="#[error.errorType.namespace == 'DB' or error.errorType.identifier == 'RETRY_EXHAUSTED']"
			enableNotifications="true"
			logException="true"
			doc:name="On Error Propagate"
			doc:id="4f538940-2297-4a74-a8f5-10abf3fada2f"
		>
			<set-variable
				value="#[503]"
				doc:name="Set the HTTP Status - 503"
				doc:id="e0bd444f-5353-4973-8a42-b66259d77e54"
				variableName="httpStatus" />
			<ee:transform
				doc:name="Set ErrorMessage"
				doc:id="062a61fe-68a8-4bd1-b62e-9b725a634a23"
			>
				<ee:variables>
					<ee:set-variable variableName="errorMessage"><![CDATA[%dw 2.0
output application/java
---
{

		"title": "The backend responded with an error",
		"detail": "The database server not reachable even after three retry."

}]]></ee:set-variable>
				</ee:variables>
			</ee:transform>
			<flow-ref
				doc:name="global-prepare-error-response-sub-flow"
				doc:id="e06753b0-21ad-438d-8896-31aa34c0e130"
				name="global-prepare-error-response-subflow" />
		</on-error-propagate>
		<!-- HTTP Requster Related error handling -->
		<on-error-propagate
			type="HTTP:BAD_REQUEST"
			enableNotifications="true"
			logException="true"
			doc:name="On Error Propagate"
			doc:id="5775435b-146b-4b7f-9fd4-8881ed356891"
		>
			<set-variable
				value="#[400]"
				doc:name="Set the HTTP Status - 400"
				doc:id="0205d75f-c2b8-4c5a-a766-a41bef050271"
				variableName="httpStatus" />
			<ee:transform
				doc:name="Set ErrorMessage"
				doc:id="cc41b4b4-e69c-48d0-8116-780f1ad9a9b7"
			>
				<ee:variables>
					<ee:set-variable variableName="errorMessage"><![CDATA[%dw 2.0
output application/java
---
{


		"title": "The backend responded with an error",
		"detail": "The server cannot or will not process the request due to an apparent client error (e.g., malformed request syntax, size too large, invalid request message framing, or deceptive request routing)."

}]]></ee:set-variable>
				</ee:variables>
			</ee:transform>
			<flow-ref
				doc:name="global-prepare-error-response-sub-flow"
				doc:id="bbbf03ea-d234-479a-bf04-1fd49749ac9f"
				name="global-prepare-error-response-subflow" />
		</on-error-propagate>
		<on-error-propagate
			type="HTTP:FORBIDDEN"
			enableNotifications="true"
			logException="true"
			doc:name="On Error Propagate"
			doc:id="8a68ebd7-cee1-4e16-afd1-cbc8d5c3ba67"
		>
			<set-variable
				value="#[403]"
				doc:name="Set the HTTP Status - 403"
				doc:id="f11f9dc6-4588-4441-8014-a680dd898a35"
				variableName="httpStatus" />
			<ee:transform
				doc:name="Set ErrorMessage"
				doc:id="7def4e56-4a10-4490-ae1c-9e777a627e28"
			>
				<ee:variables>
					<ee:set-variable variableName="errorMessage"><![CDATA[%dw 2.0
output application/java
---
{


		"title": "The backend responded with an error",
		"detail": "The request contained valid data and was understood by the server, but the server is refusing action. This may be due to the user not having the necessary permissions for a resource or needing an account of some sort, or attempting a prohibited action (e.g. creating a duplicate record where only one is allowed)."

}]]></ee:set-variable>
				</ee:variables>
			</ee:transform>
			<flow-ref
				doc:name="global-prepare-error-response-sub-flow"
				doc:id="b2b18db2-f9fb-4f92-b0c1-12e3d249ed00"
				name="global-prepare-error-response-subflow" />
		</on-error-propagate>
		<on-error-propagate
			type="HTTP:CLIENT_SECURITY"
			enableNotifications="true"
			logException="true"
			doc:name="On Error Propagate"
			doc:id="83793022-4d4b-4a88-addd-d1a3c4767eab"
		>
			<set-variable
				value="#[401]"
				doc:name="Set the HTTP Status - 401"
				doc:id="b741821c-d60c-4139-883a-f2d172487a4e"
				variableName="httpStatus" />
			<ee:transform
				doc:name="Set ErrorMessage"
				doc:id="69df932b-521e-4d7e-a409-0ea6b76efbcf"
			>
				<ee:variables>
					<ee:set-variable variableName="errorMessage"><![CDATA[%dw 2.0
output application/java
---
{

		"title": "The backend responded with an error",
		"detail": "The user does not have valid authentication credentials for the target resource."

}]]></ee:set-variable>
				</ee:variables>
			</ee:transform>
			<flow-ref
				doc:name="global-prepare-error-response-sub-flow"
				doc:id="e15bc4f2-63f7-4a37-91b6-85075383385f"
				name="global-prepare-error-response-subflow" />
		</on-error-propagate>
		<on-error-propagate
			type="HTTP:CONNECTIVITY"
			enableNotifications="true"
			logException="true"
			doc:name="On Error Propagate"
			doc:id="af503b48-9d63-4952-abdb-f1b758cae8ef"
		>
			<set-variable
				value="#[503]"
				doc:name="Set the HTTP Status - 503"
				doc:id="a7f25db2-d4e5-4bb3-aa74-ecdc31b8834f"
				variableName="httpStatus" />
			<ee:transform
				doc:name="Set ErrorMessage"
				doc:id="c6839b22-4acd-4cb3-8707-50575a9047e1"
			>
				<ee:variables>
					<ee:set-variable variableName="errorMessage"><![CDATA[%dw 2.0
output application/java
---
{


		"title": "The backend responded with an error",
		"detail": "The server cannot handle the request (because it is overloaded or down for maintenance). Generally, this is a temporary state."

}]]></ee:set-variable>
				</ee:variables>
			</ee:transform>
			<flow-ref
				doc:name="global-prepare-error-response-sub-flow"
				doc:id="f9eb0edd-1d94-4fa0-a8b3-531a26398182"
				name="global-prepare-error-response-subflow" />
		</on-error-propagate>
		<on-error-propagate
			type="HTTP:INTERNAL_SERVER_ERROR"
			enableNotifications="true"
			logException="true"
			doc:name="On Error Propagate"
			doc:id="786d05ec-4583-4019-8753-cc8b0dbc278c"
		>
			<set-variable
				value="#[500]"
				doc:name="Set the HTTP Status - 500"
				doc:id="0b015e9e-5f16-4a2a-8112-b02162ffc6b9"
				variableName="httpStatus" />
			<ee:transform
				doc:name="Set ErrorMessage"
				doc:id="2f1d8c6e-6db3-4dab-b37f-53f0d69ae10d"
			>
				<ee:variables>
					<ee:set-variable variableName="errorMessage"><![CDATA[%dw 2.0
output application/java
---
{

		"title": "The backend responded with an error",
		"detail": "The internal server error."
}]]></ee:set-variable>
				</ee:variables>
			</ee:transform>
			<flow-ref
				doc:name="global-prepare-error-response-sub-flow"
				doc:id="5072fbc8-8b48-4105-91e3-ac737e4cc7c1"
				name="global-prepare-error-response-subflow" />
		</on-error-propagate>
		<on-error-propagate
			type="HTTP:METHOD_NOT_ALLOWED"
			enableNotifications="true"
			logException="true"
			doc:name="On Error Propagate"
			doc:id="504fc11e-6916-45b1-a327-fba5a30154f0"
		>
			<set-variable
				value="#[405]"
				doc:name="Set the HTTP Status - 405"
				doc:id="797624da-17b0-407d-bbc8-9ee21e43e7f2"
				variableName="httpStatus" />
			<ee:transform
				doc:name="Set ErrorMessage"
				doc:id="d3ef587c-4ed5-4529-bdb1-fa8e30606582"
			>
				<ee:variables>
					<ee:set-variable variableName="errorMessage"><![CDATA[%dw 2.0
output application/java
---
{

		"title": "The backend responded with an error",
		"detail": "A request method is not supported for the requested resource."

}]]></ee:set-variable>
				</ee:variables>
			</ee:transform>
			<flow-ref
				doc:name="global-prepare-error-response-sub-flow"
				doc:id="86394c23-6e02-478c-b69c-9eda6aa2dda5"
				name="global-prepare-error-response-subflow" />
		</on-error-propagate>
		<on-error-propagate
			type="HTTP:NOT_ACCEPTABLE"
			enableNotifications="true"
			logException="true"
			doc:name="On Error Propagate"
			doc:id="be7a96e5-923b-4663-9768-87a32f10ba93"
		>
			<set-variable
				value="#[406]"
				doc:name="Set the HTTP Status - 406"
				doc:id="3b602a82-31b6-4526-a906-a6c5324a8905"
				variableName="httpStatus" />
			<ee:transform
				doc:name="Set ErrorMessage"
				doc:id="64aad927-237d-4b69-96c6-55b34e6bd15b"
			>
				<ee:variables>
					<ee:set-variable variableName="errorMessage"><![CDATA[%dw 2.0
output application/java
---
{

		"title": "The backend responded with an error",
		"detail": "The requested resource is capable of generating only content not acceptable according to the Accept headers sent in the request."
}]]></ee:set-variable>
				</ee:variables>
			</ee:transform>
			<flow-ref
				doc:name="global-prepare-error-response-sub-flow"
				doc:id="217a5ea4-bf68-4a9d-9d96-fec16959634c"
				name="global-prepare-error-response-subflow" />
		</on-error-propagate>
		<on-error-propagate
			type="HTTP:NOT_FOUND"
			enableNotifications="true"
			logException="true"
			doc:name="On Error Propagate"
			doc:id="90ef3e81-eb0f-4519-96f4-53d2dff86adc"
		>
			<set-variable
				value="#[404]"
				doc:name="Set the HTTP Status - 404"
				doc:id="92cb3a93-7492-40f1-bd81-96463167ad65"
				variableName="httpStatus" />
			<ee:transform
				doc:name="Set ErrorMessage"
				doc:id="9e94ddf3-73ca-4b15-b6e2-e0a801067d8a"
			>
				<ee:variables>
					<ee:set-variable variableName="errorMessage"><![CDATA[%dw 2.0
output application/java
---
{
		"title": "The backend responded with an error",
		"detail": "The requested resource could not be found but may be available in the future."

}]]></ee:set-variable>
				</ee:variables>
			</ee:transform>
			<flow-ref doc:name="global-prepare-error-response-sub-flow" doc:id="2ceb16ba-2879-4ae5-bf4d-7f4f27b7117d" name="global-prepare-error-response-subflow"/>
		</on-error-propagate>
		<on-error-propagate
			type="HTTP:PARSING"
			enableNotifications="true"
			logException="true"
			doc:name="On Error Propagate"
			doc:id="aeed6787-fe14-44e1-9f6a-9692e66d159d"
		>
			<set-variable
				value="#[400]"
				doc:name="Set the HTTP Status - 400"
				doc:id="49de252c-f81f-4597-8081-1b6abf20333e"
				variableName="httpStatus" />
			<ee:transform
				doc:name="Set ErrorMessage"
				doc:id="ed9d79f5-25fc-4a0a-8db2-442feeade7bc"
			>
				<ee:variables>
					<ee:set-variable variableName="errorMessage"><![CDATA[%dw 2.0
output application/java
---
{

		"title": "The backend responded with an error",
		"detail": "The server cannot or will not process the request due to an apparent client error (e.g., malformed request syntax, size too large, invalid request message framing, or deceptive request routing)."

}]]></ee:set-variable>
				</ee:variables>
			</ee:transform>
			<flow-ref
				doc:name="global-prepare-error-response-sub-flow"
				doc:id="416da107-359f-4bea-b341-1ce6bd8937f1"
				name="global-prepare-error-response-subflow" />
		</on-error-propagate>
		<on-error-propagate
			type="HTTP:RETRY_EXHAUSTED"
			enableNotifications="true"
			logException="true"
			doc:name="On Error Propagate"
			doc:id="fd071a1a-79d2-4ae1-8e13-c5cb4eff4937"
		>
			<set-variable
				value="#[503]"
				doc:name="Set the HTTP Status - 503"
				doc:id="b93a8cbf-b299-481a-8835-7cf7e3765682"
				variableName="httpStatus" />
			<ee:transform
				doc:name="Set ErrorMessage"
				doc:id="7b54eb54-da5f-4865-a251-ac4ae58fc2a2"
			>
				<ee:variables>
					<ee:set-variable variableName="errorMessage"><![CDATA[%dw 2.0
output application/java
---
{
		"title": "The backend responded with an error",
		"detail": "The HTTP server not reachable even after three retry."
}]]></ee:set-variable>
				</ee:variables>
			</ee:transform>
			<flow-ref
				doc:name="global-prepare-error-response-sub-flow"
				doc:id="69aba217-147a-494d-b8ed-5c7ad513f7a4"
				name="global-prepare-error-response-subflow" />
		</on-error-propagate>
		<on-error-propagate
			type="HTTP:SECURITY"
			enableNotifications="true"
			logException="true"
			doc:name="On Error Propagate"
			doc:id="af6c7e49-3df9-4108-aba7-758d4477c291"
		>
			<set-variable
				value="#[401]"
				doc:name="Set the HTTP Status - 401"
				doc:id="66fa5f2c-1b08-4e95-910e-7fc64d727840"
				variableName="httpStatus" />
			<ee:transform
				doc:name="Set ErrorMessage"
				doc:id="abba96dc-d4ae-40d1-afc1-cf67fd65110b"
			>
				<ee:variables>
					<ee:set-variable variableName="errorMessage"><![CDATA[%dw 2.0
output application/java
---
{

		"title": "The backend responded with an error",
		"detail": "The user does not have valid authentication credentials for the target resource."
}]]></ee:set-variable>
				</ee:variables>
			</ee:transform>
			<flow-ref
				doc:name="global-prepare-error-response-sub-flow"
				doc:id="9b4a77ec-92ae-4b89-ae93-1b65f6fd7e15"
				name="global-prepare-error-response-subflow" />
		</on-error-propagate>
		<on-error-propagate
			type="HTTP:TIMEOUT"
			enableNotifications="true"
			logException="true"
			doc:name="On Error Propagate"
			doc:id="39597ad3-bebf-4396-9286-41356761208d"
		>
			<set-variable
				value="#[504]"
				doc:name="Set the HTTP Status - 504"
				doc:id="c44485cf-067a-4c4c-9739-bcfad043a26f"
				variableName="httpStatus" />
			<ee:transform
				doc:name="Set ErrorMessage"
				doc:id="d77ff19a-11ab-4d94-b635-801eff0650b0"
			>
				<ee:variables>
					<ee:set-variable variableName="errorMessage"><![CDATA[%dw 2.0
output application/java
---
{
		"title": "The backend responded with an error",
		"detail": "The server was acting as a gateway or proxy and did not receive a timely response from the upstream server."
}]]></ee:set-variable>
				</ee:variables>
			</ee:transform>
			<flow-ref
				doc:name="global-prepare-error-response-sub-flow"
				doc:id="4bb6bed6-5cc6-4b09-b919-520b5c668514"
				name="global-prepare-error-response-subflow" />
		</on-error-propagate>
		<on-error-propagate
			type="HTTP:TOO_MANY_REQUESTS"
			enableNotifications="true"
			logException="true"
			doc:name="On Error Propagate"
			doc:id="3c5685fa-4201-4644-9848-e58cdcaf0ac1"
		>
			<set-variable
				value="#[429]"
				doc:name="Set the HTTP Status - 429"
				doc:id="618ef1c9-e114-4237-b585-b35cc7c93f6d"
				variableName="httpStatus" />
			<ee:transform
				doc:name="Set ErrorMessage"
				doc:id="df406ec8-66f6-4720-aa82-f8e5a493c626"
			>
				<ee:variables>
					<ee:set-variable variableName="errorMessage"><![CDATA[%dw 2.0
output application/java
---
{
		"title": "The backend responded with an error",
		"detail": "The user has sent too many requests in a given amount of time. Intended for use with rate-limiting schemes."
}]]></ee:set-variable>
				</ee:variables>
			</ee:transform>
			<flow-ref
				doc:name="global-prepare-error-response-sub-flow"
				doc:id="f3b4212e-1bd8-4a2c-89ed-be143114d914"
				name="global-prepare-error-response-subflow" />
		</on-error-propagate>
		<on-error-propagate
			type="HTTP:UNAUTHORIZED"
			enableNotifications="true"
			logException="true"
			doc:name="On Error Propagate"
			doc:id="2cfe623a-1e39-4e5f-b8a1-7e8611b43a4d"
		>
			<set-variable
				value="#[403]"
				doc:name="Set the HTTP Status - 403"
				doc:id="e97da910-9ac8-4f06-b6b1-fcf5e15c664f"
				variableName="httpStatus" />
			<ee:transform
				doc:name="Set ErrorMessage"
				doc:id="897ae2c6-99f2-4adf-94a3-3b17f7bf0235"
			>
				<ee:variables>
					<ee:set-variable variableName="errorMessage"><![CDATA[%dw 2.0
output application/java
---
{

		"title": "The backend responded with an error",
		"detail": "The authentication is required and has failed or has not yet been provided."

}]]></ee:set-variable>
				</ee:variables>
			</ee:transform>
			<flow-ref
				doc:name="global-prepare-error-response-sub-flow"
				doc:id="693b5a5a-dac7-46fc-b9fb-66c9eeb26165"
				name="global-prepare-error-response-subflow" />
		</on-error-propagate>
		<on-error-propagate
			type="HTTP:UNSUPPORTED_MEDIA_TYPE"
			enableNotifications="true"
			logException="true"
			doc:name="On Error Propagate"
			doc:id="a91443f5-36f4-4dd0-950c-a11603d51837"
		>
			<set-variable
				value="#[415]"
				doc:name="Set the HTTP Status - 415"
				doc:id="d7e38bc1-c636-48cd-b343-2784f0feeda2"
				variableName="httpStatus" />
			<ee:transform
				doc:name="Set ErrorMessage"
				doc:id="24972d32-bba5-4c9b-8582-c475a7ca3788"
			>
				<ee:variables>
					<ee:set-variable variableName="errorMessage"><![CDATA[%dw 2.0
output application/java
---
{

		"title": "The backend responded with an error",
		"detail": "The request entity has a media type which the server or resource does not support. For example, the client uploads an image as image/svg+xml, but the server requires that images use a different format."
}]]></ee:set-variable>
				</ee:variables>
			</ee:transform>
			<flow-ref
				doc:name="global-prepare-error-response-sub-flow"
				doc:id="3acfda06-1c26-4635-8bea-cc1fba06e8d8"
				name="global-prepare-error-response-subflow" />
		</on-error-propagate>
		<!-- Streaming related exception -->
		<on-error-propagate
			type="STREAM_MAXIMUM_SIZE_EXCEEDED"
			enableNotifications="true"
			logException="true"
			doc:name="On Error Propagate"
			doc:id="57da99e4-3f3b-4065-bc60-4c75de785bed"
		>
			<set-variable
				value="#[500]"
				doc:name="Set the HTTP Status - 500"
				doc:id="943f9d0c-7ccd-4c2f-913c-d71a0b9e569f"
				variableName="httpStatus" />
			<ee:transform
				doc:name="Set ErrorMessage"
				doc:id="cacf893d-7b7b-416e-8635-5ce67a5a26b9"
			>
				<ee:variables>
					<ee:set-variable variableName="errorMessage"><![CDATA[%dw 2.0
output application/java
---
{

		"title": "The backend responded with an error",
		"detail": "The stream maximum size exceeded."
	
}]]></ee:set-variable>
				</ee:variables>
			</ee:transform>
			<flow-ref
				doc:name="global-prepare-error-response-sub-flow"
				doc:id="2f7af0d8-6e79-477d-a639-4cefbb729a7a"
				name="global-prepare-error-response-subflow" />
		</on-error-propagate>
		<!-- Generic CONNECTIVITY Related Exception handling start. Order matters -->
		<on-error-propagate
			type="RETRY_EXHAUSTED"
			enableNotifications="true"
			logException="true"
			doc:name="On Error Propagate"
			doc:id="a68da73c-70ff-49c4-8d7e-e0a0f7b7f48f"
		>
			<set-variable
				value="#[503]"
				doc:name="Set the HTTP Status - 503"
				doc:id="bceb51d4-20ee-4162-ba93-295c4b7961ba"
				variableName="httpStatus" />
			<ee:transform
				doc:name="Set ErrorMessage"
				doc:id="a0e9f543-2f48-495c-a436-7e2f5eaa9c2d"
			>
				<ee:variables>
					<ee:set-variable variableName="errorMessage"><![CDATA[%dw 2.0
output application/java
---
{
		"title": "The backend responded with an error",
		"detail": "The HTTP server not reachable even after three retry."

}]]></ee:set-variable>
				</ee:variables>
			</ee:transform>
			<flow-ref
				doc:name="global-prepare-error-response-sub-flow"
				doc:id="ccd8dc09-e417-45ef-8b95-d3e6505efae4"
				name="global-prepare-error-response-subflow" />
		</on-error-propagate>
		<on-error-propagate
			type="REDELIVERY_EXHAUSTED"
			enableNotifications="true"
			logException="true"
			doc:name="On Error Propagate"
			doc:id="b92d5163-f2d0-47f7-a622-a5f5ef973520"
		>
			<set-variable
				value="#[503]"
				doc:name="Set the HTTP Status - 503"
				doc:id="8a98e8fa-8a95-4186-9f52-3d38d39aa44c"
				variableName="httpStatus" />
			<ee:transform
				doc:name="Set ErrorMessage"
				doc:id="c9222bfe-7f96-4184-a444-49db7d013c27"
			>
				<ee:variables>
					<ee:set-variable variableName="errorMessage"><![CDATA[%dw 2.0
output application/java
---
{
		"title": "The backend responded with an error",
		"detail": "The HTTP server not reachable even after three retry."
	
}]]></ee:set-variable>
				</ee:variables>
			</ee:transform>
			<flow-ref
				doc:name="global-prepare-error-response-sub-flow"
				doc:id="e844a181-6c85-4b26-b0d0-d5aa54345003"
				name="global-prepare-error-response-subflow" />
		</on-error-propagate>
		<on-error-propagate
			type="CONNECTIVITY"
			enableNotifications="true"
			logException="true"
			doc:name="On Error Propagate"
			doc:id="7839165a-4b8a-4821-b49f-203f0357931d"
		>
			<set-variable
				value="#[503]"
				doc:name="Set the HTTP Status - 503"
				doc:id="0ab50be7-9efd-4cb9-a9ac-f41b48541d26"
				variableName="httpStatus" />
			<ee:transform
				doc:name="Set ErrorMessage"
				doc:id="408da441-2de1-4d8c-8e0f-878e004aed12"
			>
				<ee:variables>
					<ee:set-variable variableName="errorMessage"><![CDATA[%dw 2.0
output application/java
---
{
		"title": "The backend responded with an error",
		"detail": "The server cannot handle the request (because it is overloaded or down for maintenance). Generally, this is a temporary state."
}]]></ee:set-variable>
				</ee:variables>
			</ee:transform>
			<flow-ref
				doc:name="global-prepare-error-response-sub-flow"
				doc:id="3de2341b-4042-4763-8c00-77707fead070"
				name="global-prepare-error-response-subflow" />
		</on-error-propagate>
		<on-error-propagate
			type="TIMEOUT"
			enableNotifications="true"
			logException="true"
			doc:name="On Error Propagate"
			doc:id="fc300bd1-ab8c-41df-a61a-f70bca58e393"
		>
			<set-variable
				value="#[504]"
				doc:name="Set the HTTP Status - 504"
				doc:id="7c2b2bbb-ffa3-4d75-9aeb-578e855e480d"
				variableName="httpStatus" />
			<ee:transform
				doc:name="Set ErrorMessage"
				doc:id="08a168c8-b4e1-4ca2-8ce5-ce64904e4650"
			>
				<ee:variables>
					<ee:set-variable variableName="errorMessage"><![CDATA[%dw 2.0
output application/java
---
{
		"title": "The backend responded with an error",
		"detail": "The server was acting as a gateway or proxy and did not receive a timely response from the upstream server."
}]]></ee:set-variable>
				</ee:variables>
			</ee:transform>
			<flow-ref
				doc:name="global-prepare-error-response-sub-flow"
				doc:id="2f054bfb-82f0-4fd6-9194-937269e6cc04"
				name="global-prepare-error-response-subflow" />
		</on-error-propagate>
		<!-- Generic CONNECTIVITY Exception handling end -->
		<on-error-propagate
			type="TRANSFORMATION"
			enableNotifications="true"
			logException="true"
			doc:name="On Error Propagate"
			doc:id="1682fb7e-a61c-4321-8d1c-dadd608b99af"
		>
			<set-variable
				value="#[400]"
				doc:name="Set the HTTP Status - 400"
				doc:id="bbfd1b1a-6d36-4bf5-9c07-a6cab1243fe2"
				variableName="httpStatus" />
			<ee:transform
				doc:name="Set ErrorMessage"
				doc:id="1382c166-6ae7-4aa4-b2b6-53ffae9643df"
			>
				<ee:variables>
					<ee:set-variable variableName="errorMessage"><![CDATA[%dw 2.0
output application/java
---
{
		"title": "The backend responded with an error",
		"detail": "The server cannot or will not process the request due to an apparent client error (e.g., malformed request syntax, size too large, invalid request message framing, or deceptive request routing)."
}]]></ee:set-variable>
				</ee:variables>
			</ee:transform>
			<flow-ref
				doc:name="global-prepare-error-response-sub-flow"
				doc:id="7eab77a2-0480-403f-8cb4-eb8948aa534a"
				name="global-prepare-error-response-subflow" />
		</on-error-propagate>
		<on-error-propagate
			enableNotifications="true"
			logException="true"
			doc:name="On Error Propagate"
			doc:id="1b4d543e-5f56-401c-97cf-8af482ce1d72"
		when="#[error.errorType.namespace == 'SCRIPTING' and error.errorType.identifier == 'COMPILATION']">
			<set-variable
				value="#[500]"
				doc:name="Set the HTTP Status - 500"
				doc:id="10c6d233-3007-49fc-94c8-be2d98b55966"
				variableName="httpStatus" />
			<ee:transform
				doc:name="Set ErrorMessage"
				doc:id="c604200a-448a-4ec5-94ab-4985fc373021"
			>
				<ee:variables>
					<ee:set-variable variableName="errorMessage"><![CDATA[%dw 2.0
output application/java
---
{
		"title": "The backend responded with an error",
		"detail": "The internal server error- Scripting compilation failed."
}]]></ee:set-variable>
				</ee:variables>
			</ee:transform>
			<flow-ref
				doc:name="global-prepare-error-response-sub-flow"
				doc:id="d0466f20-9820-4ffa-8b6c-eae4ef64501b"
				name="global-prepare-error-response-subflow" />
		</on-error-propagate>
		<on-error-propagate
      when="#[error.errorType.namespace == 'SCRIPTING' and error.errorType.identifier == 'EXECUTION']"
			enableNotifications="true"
			logException="true"
			doc:name="On Error Propagate"
			doc:id="df28e7d1-7780-4513-9fa3-68653f17a210"
		>
			<set-variable
				value="#[500]"
				doc:name="Set the HTTP Status - 500"
				doc:id="71014987-274c-497a-bb86-12731c5f747c"
				variableName="httpStatus" />
			<ee:transform
				doc:name="Set ErrorMessage"
				doc:id="35a298ba-eb4b-4c15-97cf-de2ebbab488c"
			>
				<ee:variables>
					<ee:set-variable variableName="errorMessage"><![CDATA[%dw 2.0
output application/java
---
{
		"title": "The backend responded with an error",
		"detail": "The internal server error- Scripting execution failed."
}]]></ee:set-variable>
				</ee:variables>
			</ee:transform>
			<flow-ref
				doc:name="global-prepare-error-response-sub-flow"
				doc:id="4badfb78-3112-4230-ae39-4a8323d01d56"
				name="global-prepare-error-response-subflow" />
		</on-error-propagate>
		<on-error-propagate
      when="#[error.errorType.namespace == 'SCRIPTING' and error.errorType.identifier == 'UNKNOWN_ENGINE']"
			enableNotifications="true"
			logException="true"
			doc:name="On Error Propagate"
			doc:id="bba68344-77bc-4028-a0c8-bc99ea40257c"
		>
			<set-variable
				value="#[500]"
				doc:name="Set the HTTP Status - 500"
				doc:id="df99d44e-fdfe-4932-bfea-419b4f2000e9"
				variableName="httpStatus" />
			<ee:transform
				doc:name="Set ErrorMessage"
				doc:id="d5b352ef-d3a9-467c-b12f-b14e729142e6"
			>
				<ee:variables>
					<ee:set-variable variableName="errorMessage"><![CDATA[%dw 2.0
output application/java
---
{
		"title": "The backend responded with an error",
		"detail": "The internal server error - Scripting : Unknown engine."
	
}]]></ee:set-variable>
				</ee:variables>
			</ee:transform>
			<flow-ref
				doc:name="global-prepare-error-response-sub-flow"
				doc:id="62a8dd00-4354-48f2-9017-a290e832883f"
				name="global-prepare-error-response-subflow" />
		</on-error-propagate>
		<on-error-propagate
			type="EXPRESSION"
			enableNotifications="true"
			logException="true"
			doc:name="On Error Propagate"
			doc:id="1629a478-bcb1-4e12-8827-9f1e53a1fd36"
		>
			<set-variable
				value="#[500]"
				doc:name="Set the HTTP Status - 500"
				doc:id="50ff039d-84aa-4f2c-b08f-0c0795a932c1"
				variableName="httpStatus" />
			<ee:transform
				doc:name="Set ErrorMessage"
				doc:id="0ea8d8bf-92a5-4ede-9e77-60c0a3b80d86"
			>
				<ee:variables>
					<ee:set-variable variableName="errorMessage"><![CDATA[%dw 2.0
output application/java
---
{
		"title": "The backend responded with an error",
		"detail": "The internal server error - Expression."
	
}]]></ee:set-variable>
				</ee:variables>
			</ee:transform>
			<flow-ref
				doc:name="global-prepare-error-response-sub-flow"
				doc:id="da426213-56f0-4a1a-a5f1-a5122f04eb2a"
				name="global-prepare-error-response-subflow" />
		</on-error-propagate>
		<on-error-propagate
			type="ROUTING"
			enableNotifications="true"
			logException="true"
			doc:name="On Error Propagate"
			doc:id="9accfe5d-f4e5-418e-9e68-b3773cff53c1"
		>
			<set-variable
				value="#[400]"
				doc:name="Set the HTTP Status - 400"
				doc:id="c4848848-a860-4391-8422-956fbcc57c26"
				variableName="httpStatus" />
			<ee:transform
				doc:name="Set ErrorMessage"
				doc:id="44517546-1e4c-43b9-88f3-8a3701b56f2e"
			>
				<ee:variables>
					<ee:set-variable variableName="errorMessage"><![CDATA[%dw 2.0
output application/java
---
{
		"title": "The backend responded with an error",
		"detail": "The server cannot or will not process the request due to an apparent client error (e.g., malformed request syntax, size too large, invalid request message framing, or deceptive request routing)."
	
}]]></ee:set-variable>
				</ee:variables>
			</ee:transform>
			<flow-ref
				doc:name="global-prepare-error-response-sub-flow"
				doc:id="e7d02062-66e0-4bb2-9fbc-3146d8c67532"
				name="global-prepare-error-response-subflow" />
		</on-error-propagate>
		<on-error-propagate
			type="SECURITY"
			enableNotifications="true"
			logException="true"
			doc:name="On Error Propagate"
			doc:id="68ba9a3d-1a18-41f2-9640-4ca9e5b5c603"
		>
			<set-variable
				value="#[401]"
				doc:name="Set the HTTP Status - 401"
				doc:id="ffab70cf-5938-4c14-8341-ac76cee469b6"
				variableName="httpStatus" />
			<ee:transform
				doc:name="Set ErrorMessage"
				doc:id="d9fa0626-dcf9-47f5-b4e6-db8095b35d24"
			>
				<ee:variables>
					<ee:set-variable variableName="errorMessage"><![CDATA[%dw 2.0
output application/java
---
{
		"title": "The backend responded with an error",
		"detail": "The user does not have valid authentication credentials for the target resource."
	
}]]></ee:set-variable>
				</ee:variables>
			</ee:transform>
			<flow-ref
				doc:name="global-prepare-error-response-sub-flow"
				doc:id="f126f96f-4aeb-4232-b9d5-8236bcc09cdd"
				name="global-prepare-error-response-subflow" />
		</on-error-propagate>
		<on-error-propagate enableNotifications="true" logException="true" doc:name="On Error Propagate" doc:id="2e11257d-9d7d-44de-9a29-45023162967b" when="#[error.errorType.namespace == 'APP' and error.errorType.identifier == 'ERROR']">
			<flow-ref doc:name="global-prepare-error-response-sub-flow" doc:id="d13de9b5-7035-4575-9f3f-94d7c2b9f0e9" name="global-prepare-error-response-subflow" />
		</on-error-propagate>
		<!-- If none of the above matches then handle a the exception using generic handler -->
		<on-error-propagate
			type="ANY"
			enableNotifications="true"
			logException="true"
			doc:name="On Error Propagate"
			doc:id="88a89fc9-d0d3-4064-a213-901a9496e0a8"
		>
			<set-variable
				value="#[500]"
				doc:name="Set HTTP Status - 500"
				variableName="httpStatus" />
			<ee:transform
				doc:name="Set ErrorMessage"
				doc:id="25409873-6981-4557-a243-fcd646bcbfd1"
			>
				<ee:variables>
					<ee:set-variable variableName="errorMessage"><![CDATA[%dw 2.0
output application/java
---
{
		"title": "The backend responded with an error",
		"detail": "The internal server error."
}]]></ee:set-variable>
				</ee:variables>
			</ee:transform>
			<flow-ref
				doc:name="global-prepare-error-response-sub-flow"
				doc:id="cddff0c5-272b-4a07-b064-b88a21662dd9"
				name="global-prepare-error-response-subflow" />
		</on-error-propagate>

	</error-handler>
	
	<sub-flow
		name="global-prepare-error-response-subflow"
		doc:id="b6b01a7a-74fb-45e9-b2d4-ccf6d9649068"
	>
		<ee:transform
			doc:name="Init Variables"
			doc:id="20f7a5c9-6dc5-4198-a063-ded2ae5fa7a1"
		>
			<ee:message>
			</ee:message>
			<ee:variables>
				<ee:set-variable variableName="errorRaised"><![CDATA[%dw 2.0
output application/java
---
true]]></ee:set-variable>
				<ee:set-variable variableName="logCategory"><![CDATA[%dw 2.0
output application/java
---
'Exception']]></ee:set-variable>
				<ee:set-variable variableName="logLevel"><![CDATA[%dw 2.0
output application/java
---
'ERROR']]></ee:set-variable>
				<ee:set-variable variableName="errorCode"><![CDATA[%dw 2.0
output application/java
---
if(vars.errorCode?) 
	vars.errorCode
else if(vars.httpStatus?)
	vars.httpStatus
else if(error.muleMessage.payload?) 
	error.muleMessage.payload.error.errorCode
else 
	500]]></ee:set-variable>
				<ee:set-variable variableName="outboundHeaders"><![CDATA[output application/java
---
{
	"Content-Type": "application/json",
	"X-CORRELATION-ID": correlationId
}]]></ee:set-variable>
			</ee:variables>
		</ee:transform>
		<set-variable value='#[{&#10;	"stage": "End" &#10;}]' doc:name="Set metadata" doc:id="b0f72082-293a-4f42-adf6-2be2ddebd156" variableName="metadata" />
		<flow-ref doc:name="log-subflow" doc:id="b0746156-9efa-4f26-b4d8-36fd03214d9c" name="log-subflow"/>
		<ee:transform
			doc:name="Compose Error Payload"
			doc:id="21a4fc1d-2755-4fde-b97a-921c1f1c75f9"
		>
			<ee:message>
				<ee:set-payload><![CDATA[%dw 2.0
output application/json
---
{
	errors: [{
		status: vars['errorCode'] default 500,
		title:  vars['errorMessage']['title'] default 'Error',
    	detail: vars['errorMessage']['detail'] default 'Error'
	}]
}]]></ee:set-payload>
			</ee:message>
		</ee:transform>
		<flow-ref doc:name="send-application-processing-status-metrics-subflow" doc:id="8c57fbc3-6e69-4398-9d90-c739389d4f44" name="send-application-processing-status-metrics-subflow"/>
	</sub-flow>
	</mule>
